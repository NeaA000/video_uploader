<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‹¤êµ­ì–´ ê°•ì˜ ì—…ë¡œë“œ ì‹œìŠ¤í…œ v3.0</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #2a9d8f 0%, #238b7f 100%);
      color: white;
      padding: 40px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
      font-weight: 700;
    }
    
    .header p {
      font-size: 16px;
      opacity: 0.9;
      margin-bottom: 20px;
    }
    
    .language-badges {
      display: flex;
      justify-content: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .language-badge {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      backdrop-filter: blur(10px);
    }
    
    .main-content {
      padding: 40px;
    }
    
    /* íƒ­ ìŠ¤íƒ€ì¼ */
    .tabs {
      display: flex;
      background: #f8f9fa;
      border-radius: 10px;
      padding: 5px;
      margin-bottom: 30px;
      gap: 5px;
    }
    
    .tab {
      flex: 1;
      padding: 15px 20px;
      background: none;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      color: #666;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .tab:hover {
      background: rgba(42, 157, 143, 0.1);
      color: #2a9d8f;
    }
    
    .tab.active {
      background: #2a9d8f;
      color: white;
      box-shadow: 0 2px 8px rgba(42, 157, 143, 0.3);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* í¼ ìŠ¤íƒ€ì¼ */
    .form-section {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      border: 1px solid #e9ecef;
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #2a9d8f;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group:last-child {
      margin-bottom: 0;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }
    
    .required {
      color: #e74c3c;
    }
    
    input[type="text"],
    select,
    textarea {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: white;
    }
    
    input[type="text"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #2a9d8f;
      box-shadow: 0 0 0 3px rgba(42, 157, 143, 0.1);
    }
    
    textarea {
      resize: vertical;
      min-height: 150px;
      font-family: inherit;
      line-height: 1.6;
    }
    
    /* íŒŒì¼ ì—…ë¡œë“œ ìŠ¤íƒ€ì¼ */
    .file-upload {
      position: relative;
      display: block;
      width: 100%;
      min-height: 120px;
      border: 3px dashed #dee2e6;
      border-radius: 15px;
      background: #f8f9fa;
      transition: all 0.3s ease;
      cursor: pointer;
      overflow: hidden;
    }
    
    .file-upload:hover {
      border-color: #2a9d8f;
      background: rgba(42, 157, 143, 0.05);
    }
    
    .file-upload.dragover {
      border-color: #2a9d8f;
      background: rgba(42, 157, 143, 0.1);
    }
    
    .file-upload input[type="file"] {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }
    
    .file-upload-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 120px;
      text-align: center;
      padding: 20px;
    }
    
    .file-upload-icon {
      font-size: 48px;
      color: #6c757d;
      margin-bottom: 10px;
    }
    
    .file-upload-text {
      color: #6c757d;
      font-size: 16px;
      font-weight: 600;
    }
    
    .file-upload-subtext {
      color: #adb5bd;
      font-size: 14px;
      margin-top: 5px;
    }
    
    .file-selected {
      background: rgba(40, 167, 69, 0.1) !important;
      border-color: #28a745 !important;
    }
    
    .file-selected .file-upload-content {
      color: #28a745;
    }
    
    /* ê°•ì˜ ë‚´ìš© í…œí”Œë¦¿ */
    .template-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    .template-btn {
      padding: 8px 16px;
      background: #e9ecef;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .template-btn:hover {
      background: #2a9d8f;
      color: white;
    }
    
    .template-btn.translate {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: 600;
    }
    
    .template-btn.translate:hover {
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    /* ë²ˆì—­ í™•ì¸ ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
    }
    
    .modal-content {
      background-color: white;
      margin: 5% auto;
      padding: 30px;
      border-radius: 20px;
      width: 90%;
      max-width: 700px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      position: relative;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #2a9d8f;
      margin-bottom: 10px;
    }
    
    .original-title {
      background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 100%);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 25px;
      text-align: center;
      border-left: 4px solid #2a9d8f;
    }
    
    .original-title-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .original-title-text {
      font-size: 18px;
      font-weight: 700;
      color: #2a9d8f;
    }
    
    .translation-item {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding: 15px;
      background: white;
      border-radius: 10px;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }
    
    .translation-item:hover {
      border-color: #2a9d8f;
      box-shadow: 0 2px 10px rgba(42, 157, 143, 0.1);
    }
    
    .language-flag {
      font-size: 24px;
      min-width: 40px;
      text-align: center;
    }
    
    .language-info {
      flex: 1;
    }
    
    .language-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }
    
    .translation-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 14px;
    }
    
    .translation-input:focus {
      outline: none;
      border-color: #2a9d8f;
    }
    
    .alternatives-btn {
      padding: 8px 12px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .alternatives-btn:hover {
      background: #5a6268;
    }
    
    .loading-indicator {
      text-align: center;
      padding: 40px;
      color: #2a9d8f;
    }
    
    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2a9d8f;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .modal-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }
    
    .btn-confirm {
      background: linear-gradient(135deg, #2a9d8f 0%, #238b7f 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-confirm:hover {
      background: linear-gradient(135deg, #238b7f 0%, #1e7a6d 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(42, 157, 143, 0.3);
    }
    
    .btn-cancel {
      background: #6c757d;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-cancel:hover {
      background: #5a6268;
    }
    
    .close-modal {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 28px;
      font-weight: bold;
      color: #aaa;
      cursor: pointer;
      line-height: 1;
    }
    
    .close-modal:hover {
      color: #333;
    }
    
    /* ëŒ€ì•ˆ ì œëª© ëª¨ë‹¬ */
    .alternatives-modal {
      display: none;
      position: fixed;
      z-index: 1001;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
    }
    
    .alternatives-content {
      background-color: white;
      margin: 10% auto;
      padding: 25px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .alternatives-title {
      font-size: 18px;
      font-weight: 700;
      color: #2a9d8f;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .alternative-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .alternative-option:hover {
      background: #f8f9fa;
    }
    
    .alternative-option input[type="radio"] {
      margin: 0;
    }
    
    .alternative-text {
      flex: 1;
      font-size: 14px;
    }
    
    /* ë„ì›€ë§ í…ìŠ¤íŠ¸ */
    .help-text {
      font-size: 13px;
      color: #6c757d;
      margin-top: 8px;
      line-height: 1.4;
    }
    
    .help-highlight {
      background: #e8f5e8;
      border-left: 4px solid #2a9d8f;
      padding: 12px 16px;
      margin-top: 10px;
      border-radius: 0 8px 8px 0;
      font-size: 14px;
      color: #2a9d8f;
      font-weight: 500;
    }
    
    .translation-status {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      border: 1px solid #b8dabc;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
      font-weight: 600;
      color: #155724;
    }
    
    /* ì—…ë¡œë“œ ë²„íŠ¼ */
    .upload-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #2a9d8f 0%, #238b7f 100%);
      color: white;
      border: none;
      border-radius: 15px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(42, 157, 143, 0.3);
      margin-top: 30px;
    }
    
    .upload-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(42, 157, 143, 0.4);
    }
    
    .upload-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* ì§„í–‰ë¥  ë°” */
    .progress-container {
      margin-top: 20px;
      display: none;
    }
    
    .progress-bar {
      width: 100%;
      height: 25px;
      background: #e9ecef;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #2a9d8f 0%, #56ccf2 100%);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 15px;
      position: relative;
    }
    
    .progress-text {
      text-align: center;
      margin-top: 10px;
      font-weight: 600;
      color: #2a9d8f;
    }
    
    .progress-subtext {
      text-align: center;
      margin-top: 5px;
      font-size: 14px;
      color: #6c757d;
    }
    
    /* ì–¸ì–´ë³„ ì˜ìƒ ê´€ë¦¬ */
    .video-list {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
    }
    
    .video-item {
      padding: 15px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .video-item:hover {
      border-color: #2a9d8f;
      box-shadow: 0 2px 8px rgba(42, 157, 143, 0.1);
    }
    
    .video-item.selected {
      border-color: #2a9d8f;
      background: rgba(42, 157, 143, 0.05);
    }
    
    .video-title {
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
      font-size: 16px;
    }
    
    .video-info {
      font-size: 13px;
      color: #6c757d;
      margin-bottom: 10px;
    }
    
    .language-status {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    
    .lang-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .lang-badge.complete {
      background: #d4edda;
      color: #155724;
    }
    
    .lang-badge.incomplete {
      background: #f8d7da;
      color: #721c24;
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }
    
    .status-complete { background: #28a745; }
    .status-partial { background: #ffc107; }
    .status-none { background: #dc3545; }
    
    /* ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .message {
      padding: 15px 20px;
      border-radius: 10px;
      margin: 15px 0;
      font-weight: 500;
    }
    
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .header {
        padding: 25px 20px;
      }
      
      .header h1 {
        font-size: 24px;
      }
      
      .main-content {
        padding: 25px 20px;
      }
      
      .language-badges {
        gap: 5px;
      }
      
      .language-badge {
        font-size: 12px;
        padding: 4px 8px;
      }
      
      .tabs {
        flex-direction: column;
      }
      
      .tab {
        flex: none;
      }
      
      .template-buttons {
        flex-direction: column;
      }
      
      .template-btn {
        text-align: center;
      }
      
      .modal-content {
        margin: 2% auto;
        width: 95%;
        padding: 20px;
      }
      
      .translation-item {
        flex-direction: column;
        align-items: stretch;
        gap: 10px;
      }
      
      .language-flag {
        min-width: auto;
        text-align: left;
      }
    }
    
    /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-up {
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from { transform: translateY(10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- í—¤ë” ì„¹ì…˜ -->
    <div class="header">
      <h1>ğŸŒ ë‹¤êµ­ì–´ ê°•ì˜ ì—…ë¡œë“œ ì‹œìŠ¤í…œ v3.0</h1>
      <p>AI ìë™ ë²ˆì—­ìœ¼ë¡œ ì „ ì„¸ê³„ ì‚¬ìš©ìì—ê²Œ ê°•ì˜ë¥¼ ì œê³µí•˜ì„¸ìš”</p>
      <div class="language-badges">
        <span class="language-badge">ğŸ‡°ğŸ‡· í•œêµ­ì–´ (ì›ë³¸)</span>
        <span class="language-badge">ğŸ‡ºğŸ‡¸ English</span>
        <span class="language-badge">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</span>
        <span class="language-badge">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</span>
        <span class="language-badge">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</span>
        <span class="language-badge">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</span>
      </div>
    </div>

    <div class="main-content">
      <!-- íƒ­ ë©”ë‰´ -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('new-upload')">
          ğŸ“¤ ìƒˆ ê°•ì˜ ì—…ë¡œë“œ
        </button>
        <button class="tab" onclick="switchTab('language-video')">
          ğŸŒ ì–¸ì–´ë³„ ì˜ìƒ ê´€ë¦¬
        </button>
      </div>

      <!-- ìƒˆ ê°•ì˜ ì—…ë¡œë“œ íƒ­ -->
      <div id="new-upload" class="tab-content active fade-in">
        <form method="post" action="/upload" enctype="multipart/form-data" id="uploadForm">
          
          <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
          <div class="form-section">
            <div class="section-title">
              ğŸ“‹ ê¸°ë³¸ ì •ë³´
            </div>
            
            <div class="form-group">
              <label for="group_name">ê°•ì˜ëª… <span class="required">*</span></label>
              <input type="text" id="group_name" name="group_name" required 
                     placeholder="ì˜ˆ: ê¸°ì´ˆ ìš©ì ‘ ì•ˆì „êµìœ¡" />
              <div class="help-highlight">
                ğŸ’¡ í•œêµ­ì–´ë¡œ ì…ë ¥í•˜ì‹œë©´ ìë™ìœ¼ë¡œ 6ê°œ ì–¸ì–´ë¡œ ë²ˆì—­ë˜ì–´ ì „ ì„¸ê³„ ì‚¬ìš©ìê°€ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
              </div>
            </div>
          </div>

          <!-- ì¹´í…Œê³ ë¦¬ ì„¹ì…˜ -->
          <div class="form-section">
            <div class="section-title">
              ğŸ·ï¸ ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜
            </div>
            
            <div class="form-group">
              <label for="main_category">ëŒ€ë¶„ë¥˜ <span class="required">*</span></label>
              <select name="main_category" id="main_cat" required>
                <option value="">-- ëŒ€ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                {% for m in mains %}
                  <option value="{{ m }}">{{ m }}</option>
                {% endfor %}
              </select>
              <div class="help-text">ëŒ€ë¶„ë¥˜ë„ ìë™ìœ¼ë¡œ ë²ˆì—­ë©ë‹ˆë‹¤</div>
            </div>

            <div class="form-group">
              <label for="sub_category">ì¤‘ë¶„ë¥˜ <span class="required">*</span></label>
              <select name="sub_category" id="sub_cat" required>
                <option value="">ë¨¼ì € ëŒ€ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
              </select>
              <div class="help-text">ì¤‘ë¶„ë¥˜ë„ ìë™ìœ¼ë¡œ ë²ˆì—­ë©ë‹ˆë‹¤</div>
            </div>

            <div class="form-group">
              <label for="sub_sub_category">ì†Œë¶„ë¥˜ <span class="required">*</span></label>
              <select name="sub_sub_category" id="leaf_cat" required>
                <option value="">ë¨¼ì € ì¤‘ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
              </select>
              <div class="help-text">ì†Œë¶„ë¥˜ë„ ìë™ìœ¼ë¡œ ë²ˆì—­ë©ë‹ˆë‹¤</div>
            </div>
          </div>

          <!-- ê°•ì˜ ë‚´ìš© ì„¹ì…˜ -->
          <div class="form-section">
            <div class="section-title">
              ğŸ“ ê°•ì˜ ë‚´ìš© ì„¤ëª…
            </div>
            
            <div class="template-buttons">
              <button type="button" class="template-btn" onclick="loadSafetyTemplate()">
                ğŸ“‹ ì•ˆì „êµìœ¡ í…œí”Œë¦¿
              </button>
              <button type="button" class="template-btn" onclick="loadEquipmentTemplate()">
                ğŸ”§ ì¥ë¹„êµìœ¡ í…œí”Œë¦¿
              </button>
              <button type="button" class="template-btn" onclick="clearContent()">
                ğŸ—‘ï¸ ë‚´ìš© ì§€ìš°ê¸°
              </button>
              <button type="button" class="template-btn translate" onclick="checkFilenameTranslation()">
                ğŸŒ íŒŒì¼ëª… ë²ˆì—­ í™•ì¸
              </button>
            </div>
            
            <div class="form-group">
              <label for="content_description">ê°•ì˜ì—ì„œ ë‹¤ë£¨ëŠ” ë‚´ìš© <span class="required">*</span></label>
              <textarea id="content_description" name="content_description" required 
                        placeholder="ê°•ì˜ ë‚´ìš©ì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”...">ì´ ê°•ì˜ëŠ” ì•ˆì „êµìœ¡ ê´€ë ¨ ì•ˆì „êµìœ¡ìœ¼ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤:
â€¢ ê¸°ë³¸ ì•ˆì „ìˆ˜ì¹™
â€¢ ì‘ì—… ì „ ì ê²€ì‚¬í•­
â€¢ ìœ„í—˜ ìƒí™© ëŒ€ì²˜ë°©ë²•
â€¢ ì‘ê¸‰ì²˜ì¹˜ ë° ë¹„ìƒëŒ€ì‘
â€¢ ê´€ë ¨ ë²•ê·œ ë° ê·œì •

â€» ìœ„ ë‚´ìš©ì„ ê°•ì˜ì— ë§ê²Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”.</textarea>
              <div class="help-text">êµ¬ì²´ì ì´ê³  ìƒì„¸í•œ ë‚´ìš©ì¼ìˆ˜ë¡ ë” ì¢‹ì€ ë²ˆì—­ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>
            </div>
            
            <div id="translationStatus" class="translation-status" style="display: none;">
              âœ… íŒŒì¼ëª… ë²ˆì—­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì—…ë¡œë“œë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
          </div>

          <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
          <div class="form-section">
            <div class="section-title">
              ğŸ“ íŒŒì¼ ì—…ë¡œë“œ
            </div>
            
            <div class="form-group">
              <label>ë™ì˜ìƒ íŒŒì¼ <span class="required">*</span></label>
              <div class="file-upload" id="videoUpload">
                <input type="file" id="file" name="file" accept="video/*" required />
                <div class="file-upload-content">
                  <div class="file-upload-icon">ğŸ¬</div>
                  <div class="file-upload-text">ë™ì˜ìƒ íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
                  <div class="file-upload-subtext">MP4, AVI, MOV ë“± ëª¨ë“  ë™ì˜ìƒ í˜•ì‹ ì§€ì› (ìµœëŒ€ 5GB)</div>
                </div>
              </div>
              <div id="selectedVideo" class="help-text"></div>
            </div>

            <div class="form-group">
              <label>ì¸ë„¤ì¼ ì´ë¯¸ì§€ (ì„ íƒì‚¬í•­)</label>
              <div class="file-upload" id="thumbnailUpload">
                <input type="file" id="thumbnail" name="thumbnail" accept="image/*" />
                <div class="file-upload-content">
                  <div class="file-upload-icon">ğŸ–¼ï¸</div>
                  <div class="file-upload-text">ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì„ íƒ (ì„ íƒì‚¬í•­)</div>
                  <div class="file-upload-subtext">JPG, PNG ë“± ì´ë¯¸ì§€ í˜•ì‹ ì§€ì›</div>
                </div>
              </div>
              <div id="selectedThumbnail" class="help-text"></div>
              <div class="help-text">ì¸ë„¤ì¼ì´ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ QR ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤</div>
            </div>
          </div>

          <!-- ìˆ¨ê²¨ì§„ ë²ˆì—­ ë°ì´í„° í•„ë“œ -->
          <input type="hidden" id="translatedFilenames" name="translated_filenames" />

          <!-- ì—…ë¡œë“œ ë²„íŠ¼ -->
          <button type="submit" id="submitBtn" class="upload-btn">
            ğŸŒ ë‹¤êµ­ì–´ ê°•ì˜ ì—…ë¡œë“œ ì‹œì‘
          </button>

          <!-- ì§„í–‰ë¥  í‘œì‹œ -->
          <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">ì—…ë¡œë“œ ì¤€ë¹„ ì¤‘...</div>
            <div class="progress-subtext" id="progressSubtext">ë²ˆì—­ ì‘ì—…ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤</div>
          </div>
        </form>
      </div>

      <!-- ì–¸ì–´ë³„ ì˜ìƒ ê´€ë¦¬ íƒ­ -->
      <div id="language-video" class="tab-content">
        <div class="form-section">
          <div class="section-title">
            ğŸŒ ê¸°ì¡´ ê°•ì˜ì— ì–¸ì–´ë³„ ì˜ìƒ ì¶”ê°€
          </div>
          
          <p style="text-align: center; color: #6c757d; margin-bottom: 20px;">
            ì´ë¯¸ ì—…ë¡œë“œí•œ ê°•ì˜ì— ë‹¤ë¥¸ ì–¸ì–´ì˜ ì˜ìƒì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
          </p>
          
          <div style="text-align: center; margin-bottom: 20px;">
            <button onclick="loadExistingVideos()" class="template-btn" style="background: #28a745; color: white;">
              ğŸ”„ ì˜ìƒ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            </button>
          </div>

          <!-- ì˜ìƒ ëª©ë¡ -->
          <div class="video-list">
            <h4 style="margin-bottom: 15px; color: #2a9d8f;">ğŸ“š ì—…ë¡œë“œëœ ê°•ì˜ ëª©ë¡</h4>
            <div id="videosList">
              <div style="text-align: center; color: #6c757d; padding: 40px;">
                <div class="loading-spinner"></div>
                ê°•ì˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
              </div>
            </div>
          </div>

          <!-- ì–¸ì–´ë³„ ì˜ìƒ ì—…ë¡œë“œ í¼ -->
          <div id="languageUploadForm" class="form-section" style="display: none;">
            <div class="section-title">
              ğŸ¬ ì–¸ì–´ë³„ ì˜ìƒ ì—…ë¡œë“œ
            </div>
            
            <div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
              <strong>ì„ íƒí•œ ê°•ì˜:</strong> <span id="selectedVideoTitle">-</span>
            </div>
            
            <form id="langVideoForm" enctype="multipart/form-data">
              <input type="hidden" id="lang_group_id" name="group_id" />
              
              <div class="form-group">
                <label for="language_code">ì–¸ì–´ ì„ íƒ <span class="required">*</span></label>
                <select id="language_code" name="language_code" required>
                  <option value="">-- ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                  <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                  <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡(ç®€ä½“)</option>
                  <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
                  <option value="th">ğŸ‡¹ğŸ‡­ à¹„à¸—à¸¢</option>
                  <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                </select>
                <div class="help-text">í•œêµ­ì–´ ì›ë³¸ ì™¸ì— ì¶”ê°€í•  ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
              </div>
              
              <div class="form-group">
                <label>ë²ˆì—­ëœ ë™ì˜ìƒ íŒŒì¼ <span class="required">*</span></label>
                <div class="file-upload" id="langVideoUpload">
                  <input type="file" id="lang_video_file" name="file" accept="video/*" required />
                  <div class="file-upload-content">
                    <div class="file-upload-icon">ğŸŒ</div>
                    <div class="file-upload-text">ì–¸ì–´ë³„ ì˜ìƒ íŒŒì¼ ì„ íƒ</div>
                    <div class="file-upload-subtext">ì›ë³¸ ì˜ìƒê³¼ ë™ì¼í•œ ê¸¸ì´ì˜ ë²ˆì—­ëœ ì˜ìƒì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                  </div>
                </div>
                <div id="selectedLangVideo" class="help-text"></div>
              </div>
              
              <button type="submit" class="upload-btn" id="langUploadBtn">
                ğŸŒ ì–¸ì–´ë³„ ì˜ìƒ ì—…ë¡œë“œ
              </button>
            </form>
            
            <div id="langUploadStatus"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ë²ˆì—­ í™•ì¸ ëª¨ë‹¬ -->
  <div id="translationModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeTranslationModal()">&times;</span>
      
      <div class="modal-header">
        <div class="modal-title">ğŸŒ íŒŒì¼ëª… ë²ˆì—­ í™•ì¸</div>
        <div class="original-title">
          <div class="original-title-label">ğŸ‡°ğŸ‡· ì›ë³¸ ê°•ì˜ëª… (í•œêµ­ì–´)</div>
          <div class="original-title-text" id="originalTitleText">-</div>
        </div>
      </div>
      
      <div id="translationLoadingArea" class="loading-indicator">
        <div class="loading-spinner"></div>
        <div>AIê°€ ê°•ì˜ëª…ì„ ë²ˆì—­í•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>
        <div style="font-size: 14px; color: #666; margin-top: 10px;">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
      </div>
      
      <div id="translationResultArea" style="display: none;">
        <div id="translationItems"></div>
        
        <div class="modal-buttons">
          <button class="btn-confirm" onclick="confirmTranslations()">
            âœ… ë²ˆì—­ í™•ì¸ ë° ì ìš©
          </button>
          <button class="btn-cancel" onclick="closeTranslationModal()">
            âŒ ì·¨ì†Œ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ëŒ€ì•ˆ ì œëª© ëª¨ë‹¬ -->
  <div id="alternativesModal" class="alternatives-modal">
    <div class="alternatives-content">
      <div class="alternatives-title" id="alternativesTitle">ğŸ’¡ ëŒ€ì•ˆ ì œëª© ì„ íƒ</div>
      <div id="alternativesOptions"></div>
      <div style="text-align: center; margin-top: 20px;">
        <button class="btn-confirm" onclick="applyAlternative()">âœ… ì ìš©</button>
        <button class="btn-cancel" onclick="closeAlternativesModal()">âŒ ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ ë°ì´í„° -->
  <script id="subs-data" type="application/json">
    {{ subs | tojson }}
  </script>
  <script id="leafs-data" type="application/json">
    {{ leafs | tojson }}
  </script>

  <script>
    // ì „ì—­ ë³€ìˆ˜
    let cachedVideos = [];
    let translatedFilenames = {};
    let currentAlternativeLanguage = '';
    const koreanTitle = '';  // ì›ë³¸ ì œëª© ì €ì¥ìš©
    
    // JSON íŒŒì‹±
    const subs = JSON.parse(document.getElementById('subs-data').textContent);
    const leafs = JSON.parse(document.getElementById('leafs-data').textContent);
    
    const mainSel = document.getElementById('main_cat');
    const subSel = document.getElementById('sub_cat');
    const leafSel = document.getElementById('leaf_cat');

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸŒ ë‹¤êµ­ì–´ ê°•ì˜ ì—…ë¡œë“œ ì‹œìŠ¤í…œ v3.0 ì‹œì‘');
      initializeFileUploads();
      initializeCategorySelectors();
    });

    // íŒŒì¼ ì—…ë¡œë“œ ì´ˆê¸°í™”
    function initializeFileUploads() {
      // ë™ì˜ìƒ íŒŒì¼ ì—…ë¡œë“œ
      const videoUpload = document.getElementById('videoUpload');
      const videoInput = document.getElementById('file');
      
      videoInput.addEventListener('change', function(e) {
        handleFileSelect(e.target.files[0], 'video');
      });
      
      // ë“œë˜ê·¸ ì•¤ ë“œë¡­
      videoUpload.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('dragover');
      });
      
      videoUpload.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
      });
      
      videoUpload.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('video/')) {
          videoInput.files = e.dataTransfer.files;
          handleFileSelect(file, 'video');
        }
      });
      
      // ì¸ë„¤ì¼ íŒŒì¼ ì—…ë¡œë“œ
      const thumbnailInput = document.getElementById('thumbnail');
      thumbnailInput.addEventListener('change', function(e) {
        handleFileSelect(e.target.files[0], 'thumbnail');
      });
      
      // ì–¸ì–´ë³„ ì˜ìƒ íŒŒì¼ ì—…ë¡œë“œ
      const langVideoInput = document.getElementById('lang_video_file');
      langVideoInput.addEventListener('change', function(e) {
        handleFileSelect(e.target.files[0], 'langVideo');
      });
    }

    // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
    function handleFileSelect(file, type) {
      if (!file) return;
      
      const fileName = file.name;
      const fileSize = (file.size / (1024 * 1024)).toFixed(2);
      
      let targetElement, uploadElement;
      
      switch(type) {
        case 'video':
          targetElement = document.getElementById('selectedVideo');
          uploadElement = document.getElementById('videoUpload');
          if (file.size > 5 * 1024 * 1024 * 1024) {
            targetElement.textContent = 'âŒ íŒŒì¼ í¬ê¸°ê°€ 5GBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤';
            targetElement.style.color = '#dc3545';
            return;
          }
          break;
        case 'thumbnail':
          targetElement = document.getElementById('selectedThumbnail');
          uploadElement = document.getElementById('thumbnailUpload');
          break;
        case 'langVideo':
          targetElement = document.getElementById('selectedLangVideo');
          uploadElement = document.getElementById('langVideoUpload');
          break;
      }
      
      targetElement.textContent = `âœ… ì„ íƒëœ íŒŒì¼: ${fileName} (${fileSize} MB)`;
      targetElement.style.color = '#28a745';
      uploadElement.classList.add('file-selected');
    }

    // ì¹´í…Œê³ ë¦¬ ì„ íƒê¸° ì´ˆê¸°í™”
    function initializeCategorySelectors() {
      mainSel.addEventListener('change', () => {
        const mids = subs[mainSel.value] || [];
        subSel.innerHTML = '<option value="">-- ì¤‘ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>' +
          mids.map(m => `<option value="${m}">${m}</option>`).join('');
        leafSel.innerHTML = '<option value="">ë¨¼ì € ì¤‘ë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
        
        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        subSel.classList.add('slide-up');
        setTimeout(() => subSel.classList.remove('slide-up'), 300);
      });

      subSel.addEventListener('change', () => {
        const lst = leafs[subSel.value] || [];
        leafSel.innerHTML = '<option value="">-- ì†Œë¶„ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>' +
          lst.map(l => `<option value="${l}">${l}</option>`).join('');
        
        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        leafSel.classList.add('slide-up');
        setTimeout(() => leafSel.classList.remove('slide-up'), 300);
      });
    }

    // íƒ­ ì „í™˜
    function switchTab(tabName) {
      // ëª¨ë“  íƒ­ê³¼ ì»¨í…ì¸  ë¹„í™œì„±í™”
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      // ì„ íƒí•œ íƒ­ í™œì„±í™”
      event.target.classList.add('active');
      const tabContent = document.getElementById(tabName);
      tabContent.classList.add('active');
      tabContent.classList.add('fade-in');
      
      // ì–¸ì–´ë³„ ì˜ìƒ íƒ­ì„ ì„ íƒí–ˆì„ ë•Œ ì˜ìƒ ëª©ë¡ ë¡œë“œ
      if (tabName === 'language-video') {
        loadExistingVideos();
      }
    }

    // ê°•ì˜ ë‚´ìš© í…œí”Œë¦¿ ë¡œë“œ
    function loadSafetyTemplate() {
      const template = `ì´ ê°•ì˜ëŠ” ì•ˆì „êµìœ¡ ê´€ë ¨ ì•ˆì „êµìœ¡ìœ¼ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤:
â€¢ ê¸°ë³¸ ì•ˆì „ìˆ˜ì¹™
â€¢ ì‘ì—… ì „ ì ê²€ì‚¬í•­
â€¢ ìœ„í—˜ ìƒí™© ëŒ€ì²˜ë°©ë²•
â€¢ ì‘ê¸‰ì²˜ì¹˜ ë° ë¹„ìƒëŒ€ì‘
â€¢ ê´€ë ¨ ë²•ê·œ ë° ê·œì •

ì´ êµìœ¡ì„ í†µí•´ ê·¼ë¡œìë“¤ì˜ ì•ˆì „ì˜ì‹ì„ ë†’ì´ê³ , 
ì‚¬ê³  ì˜ˆë°©ì„ ìœ„í•œ ì‹¤ì§ˆì ì¸ ì§€ì‹ì„ ìŠµë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
      
      document.getElementById('content_description').value = template;
    }

    function loadEquipmentTemplate() {
      const template = `ì´ ê°•ì˜ëŠ” ì¥ë¹„ ì‚¬ìš©ë²• êµìœ¡ìœ¼ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤:
â€¢ ì¥ë¹„ êµ¬ì¡° ë° ì›ë¦¬
â€¢ ì˜¬ë°”ë¥¸ ì¡°ì‘ ë°©ë²•
â€¢ ì¼ìƒ ì ê²€ ë° ìœ ì§€ë³´ìˆ˜
â€¢ ê³ ì¥ ì‹œ ëŒ€ì²˜ë°©ë²•
â€¢ ì•ˆì „ ìš´ì „ ìˆ˜ì¹™

ì‹¤ì œ ì‘ì—… í˜„ì¥ì—ì„œ ì¦‰ì‹œ í™œìš© ê°€ëŠ¥í•œ 
ì‹¤ë¬´ ì¤‘ì‹¬ì˜ êµìœ¡ ë‚´ìš©ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`;
      
      document.getElementById('content_description').value = template;
    }

    function clearContent() {
      if (confirm('ê°•ì˜ ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        document.getElementById('content_description').value = '';
        // ë²ˆì—­ ì •ë³´ë„ ì´ˆê¸°í™”
        translatedFilenames = {};
        document.getElementById('translationStatus').style.display = 'none';
      }
    }

    // íŒŒì¼ëª… ë²ˆì—­ í™•ì¸
    function checkFilenameTranslation() {
      const groupName = document.getElementById('group_name').value.trim();
      
      if (!groupName) {
        alert('ë¨¼ì € ê°•ì˜ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        document.getElementById('group_name').focus();
        return;
      }
      
      // ëª¨ë‹¬ ì—´ê¸°
      document.getElementById('originalTitleText').textContent = groupName;
      document.getElementById('translationModal').style.display = 'block';
      document.getElementById('translationLoadingArea').style.display = 'block';
      document.getElementById('translationResultArea').style.display = 'none';
      
      // ë²ˆì—­ ì‹œì‘
      translateTitle(groupName);
    }

    // ë²ˆì—­ API í˜¸ì¶œ (ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬)
    async function translateTitle(koreanTitle) {
      try {
        // Google Translate API í˜¸ì¶œ (ë°±ì—”ë“œì—ì„œ ì²˜ë¦¬)
        const response = await fetch('/api/translate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            text: koreanTitle
            // target_languages ì œê±° - ë°±ì—”ë“œì—ì„œ ëª¨ë“  ì–¸ì–´ë¡œ ìë™ ë²ˆì—­
          })
        });
        
        if (!response.ok) {
          throw new Error('ë²ˆì—­ ì„œë¹„ìŠ¤ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        const result = await response.json();
        
        if (result.success && result.translations) {
          // ë²ˆì—­ ê²°ê³¼ í‘œì‹œ
          showTranslationResults(result.translations);
        } else {
          throw new Error(result.error || 'ë²ˆì—­ ì‹¤íŒ¨');
        }
        
      } catch (error) {
        console.error('ë²ˆì—­ ì˜¤ë¥˜:', error);
        // ëŒ€ì²´ ë²ˆì—­ ì‚¬ìš©
        const fallbackTranslations = getFallbackTranslations(koreanTitle);
        showTranslationResults(fallbackTranslations);
      }
    }

    // ëŒ€ì²´ ë²ˆì—­ (ì˜¤í”„ë¼ì¸ìš©)
    function getFallbackTranslations(koreanTitle) {
      const keywordMaps = {
        en: {
          'ì•ˆì „': 'Safety', 'êµìœ¡': 'Training', 'ê¸°ì´ˆ': 'Basic', 'ìš©ì ‘': 'Welding',
          'í¬ë ˆì¸': 'Crane', 'ì¡°ì‘': 'Operation', 'ì¥ë¹„': 'Equipment', 'ì‚¬ìš©ë²•': 'Usage',
          'ì ê²€': 'Inspection', 'ìœ ì§€ë³´ìˆ˜': 'Maintenance', 'ì‘ê¸‰ì²˜ì¹˜': 'First_Aid',
          'ì‚°ì—…': 'Industrial', 'ê±´ì„¤': 'Construction', 'ê¸°ê³„': 'Machine'
        },
        zh: {
          'ì•ˆì „': 'å®‰å…¨', 'êµìœ¡': 'åŸ¹è®­', 'ê¸°ì´ˆ': 'åŸºç¡€', 'ìš©ì ‘': 'ç„Šæ¥',
          'í¬ë ˆì¸': 'èµ·é‡æœº', 'ì¡°ì‘': 'æ“ä½œ', 'ì¥ë¹„': 'è®¾å¤‡', 'ì‚¬ìš©ë²•': 'ä½¿ç”¨æ–¹æ³•',
          'ì ê²€': 'æ£€æŸ¥', 'ìœ ì§€ë³´ìˆ˜': 'ç»´æŠ¤', 'ì‘ê¸‰ì²˜ì¹˜': 'æ€¥æ•‘'
        },
        vi: {
          'ì•ˆì „': 'An_Toan', 'êµìœ¡': 'Dao_Tao', 'ê¸°ì´ˆ': 'Co_Ban', 'ìš©ì ‘': 'Han',
          'í¬ë ˆì¸': 'Cau_Truc', 'ì¡°ì‘': 'Van_Hanh', 'ì¥ë¹„': 'Thiet_Bi'
        },
        th: {
          'ì•ˆì „': 'à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢', 'êµìœ¡': 'à¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²', 'ê¸°ì´ˆ': 'à¸à¸·à¹‰à¸™à¸à¸²à¸™', 'ìš©ì ‘': 'à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡'
        },
        ja: {
          'ì•ˆì „': 'å®‰å…¨', 'êµìœ¡': 'æ•™è‚²', 'ê¸°ì´ˆ': 'åŸºç¤', 'ìš©ì ‘': 'æº¶æ¥',
          'í¬ë ˆì¸': 'ã‚¯ãƒ¬ãƒ¼ãƒ³', 'ì¡°ì‘': 'æ“ä½œ', 'ì¥ë¹„': 'è¨­å‚™'
        }
      };
      
      const translations = {};
      
      for (const [lang, keywords] of Object.entries(keywordMaps)) {
        let result = koreanTitle;
        for (const [kr, translated] of Object.entries(keywords)) {
          result = result.replace(new RegExp(kr, 'g'), translated);
        }
        result = result.replace(/[^\w\u4e00-\u9fff\u0e00-\u0e7f]/g, '_');
        result = result.replace(/_+/g, '_').replace(/^_|_$/g, '');
        translations[lang] = result;
      }
      
      return translations;
    }

    // ë²ˆì—­ ê²°ê³¼ í‘œì‹œ
    function showTranslationResults(translations) {
      document.getElementById('translationLoadingArea').style.display = 'none';
      document.getElementById('translationResultArea').style.display = 'block';
      
      const languages = {
        en: { flag: 'ğŸ‡ºğŸ‡¸', name: 'English' },
        zh: { flag: 'ğŸ‡¨ğŸ‡³', name: 'ä¸­æ–‡(ç®€ä½“)' },
        vi: { flag: 'ğŸ‡»ğŸ‡³', name: 'Tiáº¿ng Viá»‡t' },
        th: { flag: 'ğŸ‡¹ğŸ‡­', name: 'à¹„à¸—à¸¢' },
        ja: { flag: 'ğŸ‡¯ğŸ‡µ', name: 'æ—¥æœ¬èª' }
      };
      
      const koreanTitle = document.getElementById('originalTitleText').textContent;
      
      const itemsHtml = Object.entries(languages).map(([langCode, langInfo]) => {
        const translation = translations[langCode] || koreanTitle;
        return `
          <div class="translation-item">
            <div class="language-flag">${langInfo.flag}</div>
            <div class="language-info">
              <div class="language-name">${langInfo.name}</div>
              <input type="text" class="translation-input" id="trans_${langCode}" 
                     value="${translation}" data-lang="${langCode}">
            </div>
            <button type="button" class="alternatives-btn" onclick="showAlternatives('${langCode}')">
              ğŸ’¡ ëŒ€ì•ˆ ë³´ê¸°
            </button>
          </div>
        `;
      }).join('');
      
      document.getElementById('translationItems').innerHTML = itemsHtml;
    }

    // ëŒ€ì•ˆ ì œëª© í‘œì‹œ
    function showAlternatives(langCode) {
      const koreanTitle = document.getElementById('originalTitleText').textContent;
      currentAlternativeLanguage = langCode;
      
      const alternatives = generateAlternatives(koreanTitle, langCode);
      
      const languageNames = {
        en: 'English', zh: 'ä¸­æ–‡', vi: 'Tiáº¿ng Viá»‡t', th: 'à¹„à¸—à¸¢', ja: 'æ—¥æœ¬èª'
      };
      
      document.getElementById('alternativesTitle').textContent = 
        `ğŸ’¡ ${languageNames[langCode]} ëŒ€ì•ˆ ì œëª©`;
      
      const optionsHtml = alternatives.map((alt, index) => `
        <div class="alternative-option">
          <input type="radio" name="alternative" value="${alt}" id="alt_${index}" ${index === 0 ? 'checked' : ''}>
          <label for="alt_${index}" class="alternative-text">${alt}</label>
        </div>
      `).join('');
      
      document.getElementById('alternativesOptions').innerHTML = optionsHtml;
      document.getElementById('alternativesModal').style.display = 'block';
    }

    // ëŒ€ì•ˆ ì œëª© ìƒì„±
    function generateAlternatives(koreanTitle, langCode) {
      const alternatives = [];
      const fallback = getFallbackTranslations(koreanTitle)[langCode];
      
      // ê¸°ë³¸ ë²ˆì—­
      alternatives.push(fallback);
      
      // ì¶•ì•½ ë²„ì „
      if (koreanTitle.length > 10) {
        const shortTitle = koreanTitle.substring(0, 8) + '_Short';
        alternatives.push(getFallbackTranslations(shortTitle)[langCode]);
      }
      
      // í‚¤ì›Œë“œ ì¤‘ì‹¬ ë²„ì „
      const keywords = koreanTitle.match(/[ê°€-í£]{2,}/g) || [];
      if (keywords.length > 1) {
        const keywordTitle = keywords.slice(0, 2).join('_');
        alternatives.push(getFallbackTranslations(keywordTitle)[langCode]);
      }
      
      return [...new Set(alternatives)].slice(0, 3);
    }

    // ëŒ€ì•ˆ ì ìš©
    function applyAlternative() {
      const selected = document.querySelector('input[name="alternative"]:checked');
      if (selected && currentAlternativeLanguage) {
        document.getElementById(`trans_${currentAlternativeLanguage}`).value = selected.value;
        closeAlternativesModal();
      }
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeTranslationModal() {
      document.getElementById('translationModal').style.display = 'none';
    }

    function closeAlternativesModal() {
      document.getElementById('alternativesModal').style.display = 'none';
    }

    // ë²ˆì—­ í™•ì¸ ë° ì ìš©
    function confirmTranslations() {
      const koreanTitle = document.getElementById('originalTitleText').textContent;
      const safeKoreanTitle = koreanTitle.replace(/[^\wê°€-í£]/g, '_');
      
      translatedFilenames = { ko: safeKoreanTitle };
      
      // ê° ì–¸ì–´ë³„ ë²ˆì—­ ê²°ê³¼ ìˆ˜ì§‘
      ['en', 'zh', 'vi', 'th', 'ja'].forEach(lang => {
        const input = document.getElementById(`trans_${lang}`);
        if (input) {
          translatedFilenames[lang] = input.value || safeKoreanTitle;
        }
      });
      
      // ìˆ¨ê²¨ì§„ í•„ë“œì— ì €ì¥
      document.getElementById('translatedFilenames').value = JSON.stringify(translatedFilenames);
      
      // ìƒíƒœ í‘œì‹œ
      document.getElementById('translationStatus').style.display = 'block';
      
      closeTranslationModal();
      
      console.log('ë²ˆì—­ëœ íŒŒì¼ëª…:', translatedFilenames);
    }

    // í¼ ì œì¶œ ì²˜ë¦¬
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
      // ë²ˆì—­ í™•ì¸
      if (!translatedFilenames || Object.keys(translatedFilenames).length === 0) {
        e.preventDefault();
        alert('ë¨¼ì € íŒŒì¼ëª… ë²ˆì—­ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        return false;
      }
      
      const submitBtn = document.getElementById('submitBtn');
      const progressContainer = document.getElementById('progressContainer');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const progressSubtext = document.getElementById('progressSubtext');
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'â³ ì—…ë¡œë“œ ë° ë²ˆì—­ ì²˜ë¦¬ ì¤‘...';
      progressContainer.style.display = 'block';
      
      const uploadStages = [
        { progress: 10, text: 'ğŸ“ íŒŒì¼ ê²€ì¦ ì¤‘...', subtext: 'íŒŒì¼ í˜•ì‹ê³¼ í¬ê¸°ë¥¼ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤' },
        { progress: 25, text: 'ğŸŒ ë²ˆì—­ íŒŒì¼ëª… ì ìš© ì¤‘...', subtext: 'ë²ˆì—­ëœ íŒŒì¼ëª…ìœ¼ë¡œ ì €ì¥ ê²½ë¡œë¥¼ ì„¤ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤' },
        { progress: 40, text: 'â˜ï¸ í´ë¼ìš°ë“œ ì—…ë¡œë“œ ì¤‘...', subtext: 'ì•ˆì „í•œ í´ë¼ìš°ë“œ ì €ì¥ì†Œë¡œ ì—…ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤' },
        { progress: 55, text: 'ğŸ¬ ë™ì˜ìƒ ì •ë³´ ë¶„ì„ ì¤‘...', subtext: 'ë™ì˜ìƒ ê¸¸ì´ì™€ í’ˆì§ˆì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤' },
        { progress: 70, text: 'ğŸ·ï¸ QR ì½”ë“œ ìƒì„± ì¤‘...', subtext: 'ë‹¤êµ­ì–´ QR ì½”ë“œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤' },
        { progress: 85, text: 'ğŸ”„ ë°±ê·¸ë¼ìš´ë“œ ë²ˆì—­ ì˜ˆì•½...', subtext: 'ì¤‘êµ­ì–´, ë² íŠ¸ë‚¨ì–´, íƒœêµ­ì–´, ì¼ë³¸ì–´ ë²ˆì—­ ëŒ€ê¸° ì¤‘' },
        { progress: 95, text: 'âœ… ìµœì¢… ê²€ì¦ ì¤‘...', subtext: 'ëª¨ë“  ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ í™•ì¸í•˜ê³  ìˆìŠµë‹ˆë‹¤' }
      ];
      
      let currentStage = 0;
      const stageInterval = setInterval(() => {
        if (currentStage < uploadStages.length) {
          const stage = uploadStages[currentStage];
          progressFill.style.width = stage.progress + '%';
          progressText.textContent = stage.text;
          progressSubtext.textContent = stage.subtext;
          currentStage++;
        } else {
          clearInterval(stageInterval);
          progressFill.style.width = '100%';
          progressText.textContent = 'ğŸ‰ ì—…ë¡œë“œ ì™„ë£Œ!';
          progressSubtext.textContent = 'ë²ˆì—­ ì‘ì—…ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ê³„ì†ë˜ë©°, ì ì‹œ í›„ ì„±ê³µ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...';
        }
      }, 1000);
    });

    // ê¸°ì¡´ ì˜ìƒ ëª©ë¡ ë¡œë“œ
    async function loadExistingVideos() {
      const videosList = document.getElementById('videosList');
      
      try {
        videosList.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="loading-spinner"></div>ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

        const response = await fetch('/api/admin/videos', {
          method: 'GET',
          credentials: 'same-origin',
          headers: { 'Content-Type': 'application/json' }
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();
        cachedVideos = result.videos || [];
        renderVideosList(cachedVideos);
        
      } catch (error) {
        console.error('ì˜ìƒ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        videosList.innerHTML = `
          <div class="message error">
            âŒ ì˜ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${error.message}
            <br><button onclick="loadExistingVideos()" style="margin-top: 10px; padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer;">ë‹¤ì‹œ ì‹œë„</button>
          </div>
        `;
      }
    }

    // ì˜ìƒ ëª©ë¡ ë Œë”ë§
    function renderVideosList(videos) {
      const videosList = document.getElementById('videosList');
      
      if (!videos || videos.length === 0) {
        videosList.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 40px;">ğŸ“‚ ì—…ë¡œë“œëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
      }
      
      videosList.innerHTML = videos.map(video => {
        const videoLanguages = video.languages || { ko: true };
        const allLanguages = ['ko', 'en', 'zh', 'vi', 'th', 'ja'];
        const languageNames = { ko: 'í•œêµ­ì–´', en: 'English', zh: 'ä¸­æ–‡', vi: 'Tiáº¿ng Viá»‡t', th: 'à¹„à¸—à¸¢', ja: 'æ—¥æœ¬èª' };
        const languageFlags = { ko: 'ğŸ‡°ğŸ‡·', en: 'ğŸ‡ºğŸ‡¸', zh: 'ğŸ‡¨ğŸ‡³', vi: 'ğŸ‡»ğŸ‡³', th: 'ğŸ‡¹ğŸ‡­', ja: 'ğŸ‡¯ğŸ‡µ' };
        
        const hasVideoCount = Object.values(videoLanguages).filter(Boolean).length;
        const statusClass = hasVideoCount === allLanguages.length ? 'complete' : 
                           hasVideoCount > 1 ? 'partial' : 'none';
        
        return `
          <div class="video-item" onclick="selectVideo('${video.group_id}', '${video.title.replace(/'/g, "\\'")}', ${JSON.stringify(videoLanguages).replace(/"/g, '&quot;')})">
            <div class="video-title">
              <span class="status-indicator status-${statusClass}"></span>
              ${video.title}
            </div>
            <div class="video-info">
              ì—…ë¡œë“œ: ${video.upload_date || 'N/A'} | ì¹´í…Œê³ ë¦¬: ${video.main_category} > ${video.sub_category} > ${video.sub_sub_category}
            </div>
            <div class="language-status">
              ${allLanguages.map(lang => {
                const hasVideo = videoLanguages[lang] || false;
                return `
                  <span class="lang-badge ${hasVideo ? 'complete' : 'incomplete'}">
                    ${languageFlags[lang]} ${languageNames[lang]}
                    ${hasVideo ? 'âœ…' : 'âŒ'}
                  </span>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    // ì˜ìƒ ì„ íƒ
    function selectVideo(videoId, videoTitle, languages = {}) {
      // ì´ì „ ì„ íƒ í•´ì œ
      document.querySelectorAll('.video-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      // í˜„ì¬ ì„ íƒ í‘œì‹œ
      event.currentTarget.classList.add('selected');
      
      // í¼ í‘œì‹œ ë° ì •ë³´ ì„¤ì •
      document.getElementById('languageUploadForm').style.display = 'block';
      document.getElementById('lang_group_id').value = videoId;
      document.getElementById('selectedVideoTitle').textContent = videoTitle;

      // ì´ë¯¸ ì—…ë¡œë“œëœ ì–¸ì–´ë“¤ì€ ì„ íƒì—ì„œ ì œì™¸
      const languageSelect = document.getElementById('language_code');
      const options = languageSelect.querySelectorAll('option');
      
      options.forEach(option => {
        const langCode = option.value;
        if (langCode && languages[langCode]) {
          option.disabled = true;
          option.style.color = '#999';
          option.textContent = option.textContent.replace(' (ì—…ë¡œë“œë¨)', '') + ' (ì—…ë¡œë“œë¨)';
        } else {
          option.disabled = false;
          option.style.color = '';
          option.textContent = option.textContent.replace(' (ì—…ë¡œë“œë¨)', '');
        }
      });

      // ì„ íƒ ê°€ëŠ¥í•œ ì–¸ì–´ê°€ ìˆëŠ”ì§€ í™•ì¸
      const availableLanguages = Array.from(options).filter(option => option.value && !option.disabled);
      if (availableLanguages.length === 0) {
        document.getElementById('langUploadStatus').innerHTML = `
          <div class="message success">
            âœ… ì´ ê°•ì˜ëŠ” ëª¨ë“  ì–¸ì–´ì˜ ë™ì˜ìƒì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!
          </div>
        `;
      } else {
        document.getElementById('langUploadStatus').innerHTML = '';
      }
    }

    // ì–¸ì–´ë³„ ì˜ìƒ ì—…ë¡œë“œ
    document.getElementById('langVideoForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const langUploadBtn = document.getElementById('langUploadBtn');
      const langUploadStatus = document.getElementById('langUploadStatus');
      const selectedLang = formData.get('language_code');
      
      langUploadBtn.disabled = true;
      langUploadBtn.innerHTML = '<div class="loading-spinner"></div>ì—…ë¡œë“œ ì¤‘...';
      langUploadStatus.innerHTML = '<div class="message info">ğŸ“¤ ì–¸ì–´ë³„ ì˜ìƒì„ ì—…ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤...</div>';
      
      try {
        const response = await fetch('/api/admin/upload_language_video', {
          method: 'POST',
          body: formData,
          credentials: 'same-origin'
        });
        
        const result = await response.json();
        
        if (response.ok) {
          const languageNames = { en: 'English', zh: 'ä¸­æ–‡', vi: 'Tiáº¿ng Viá»‡t', th: 'à¹„à¸—à¸¢', ja: 'æ—¥æœ¬èª' };
          const languageFlags = { en: 'ğŸ‡ºğŸ‡¸', zh: 'ğŸ‡¨ğŸ‡³', vi: 'ğŸ‡»ğŸ‡³', th: 'ğŸ‡¹ğŸ‡­', ja: 'ğŸ‡¯ğŸ‡µ' };
          
          langUploadStatus.innerHTML = `
            <div class="message success">
              âœ… ì—…ë¡œë“œ ì™„ë£Œ!<br>
              ${languageFlags[selectedLang]} ${languageNames[selectedLang]} ì˜ìƒì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.
            </div>
          `;
          
          // í¼ ì´ˆê¸°í™”
          e.target.reset();
          document.getElementById('selectedLangVideo').textContent = '';
          document.getElementById('langVideoUpload').classList.remove('file-selected');
          
          // ì˜ìƒ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
          setTimeout(() => {
            loadExistingVideos();
            langUploadStatus.innerHTML = '';
          }, 3000);
          
        } else {
          langUploadStatus.innerHTML = `
            <div class="message error">
              âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
            </div>
          `;
        }
      } catch (error) {
        console.error('ì–¸ì–´ë³„ ì˜ìƒ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        langUploadStatus.innerHTML = `
          <div class="message error">
            âŒ ì˜¤ë¥˜: ${error.message}
          </div>
        `;
      } finally {
        langUploadBtn.disabled = false;
        langUploadBtn.innerHTML = 'ğŸŒ ì–¸ì–´ë³„ ì˜ìƒ ì—…ë¡œë“œ';
      }
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
      const translationModal = document.getElementById('translationModal');
      const alternativesModal = document.getElementById('alternativesModal');
      
      if (event.target === translationModal) {
        closeTranslationModal();
      }
      if (event.target === alternativesModal) {
        closeAlternativesModal();
      }
    }

    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeTranslationModal();
        closeAlternativesModal();
      }
    });

    console.log('ğŸŒ ë‹¤êµ­ì–´ ê°•ì˜ ì—…ë¡œë“œ ì‹œìŠ¤í…œ v3.0 ì´ˆê¸°í™” ì™„ë£Œ');
    console.log('ğŸ¯ ì£¼ìš” ê¸°ëŠ¥: ì‹¤ì‹œê°„ ë²ˆì—­, íŒŒì¼ëª… ìë™ ë³€í™˜, ì–¸ì–´ë³„ ì˜ìƒ ê´€ë¦¬');
  </script>
</body>
</html>